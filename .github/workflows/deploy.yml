name: Deploy MkDocs to GitHub Pages

on:
  # main ë¸Œëœì¹˜ì— pushë  ë•Œ ìë™ ë°°í¬
  push:
    branches:
      - main
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥ (ë²„ì „ ì…ë ¥ ë°›ìŒ)
  workflow_dispatch:
    inputs:
      version:
        description: 'ë°°í¬í•  ë²„ì „ (ì˜ˆ: v1.0, v1.1)'
        required: true
        default: 'latest'

# GitHub Pagesì— ë°°í¬í•˜ê¸° ìœ„í•œ ê¶Œí•œ
permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # mikeê°€ git íˆìŠ¤í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì „ì²´ íˆìŠ¤í† ë¦¬ í•„ìš”

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Cache dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Deploy with mike
        run: |
          # workflow_dispatchë¡œ ì‹¤í–‰ë˜ë©´ ì…ë ¥ë°›ì€ ë²„ì „ ì‚¬ìš©
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            VERSION="${{ github.event.inputs.version }}"
            echo "ğŸ“¦ ìˆ˜ë™ ë°°í¬: ë²„ì „ $VERSION"
            mike deploy --push --update-aliases $VERSION latest
            mike set-default --push latest
          else
            # push ì´ë²¤íŠ¸ë©´ latestë¡œ ë°°í¬
            echo "ğŸ“¦ ìë™ ë°°í¬: latest"
            mike deploy --push --update-aliases latest
            mike set-default --push latest
          fi

      - name: Deploy result
        run: |
          echo "âœ… ë°°í¬ ì™„ë£Œ!"
          echo "ğŸŒ ì‚¬ì´íŠ¸ URL: https://kwag93.github.io/claude-code-onboarding-site/"
